<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>タスク作成</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    header, nav {
      margin-bottom: 20px;
    }
    form div {
      margin-bottom: 10px;
    }
    label {
      display: inline-block;
      width: 120px;
    }
    input[type="text"], input[type="date"], select {
      width: 200px;
    }
  </style>
</head>
<body>
  <header>
    <h1>タスク作成</h1>
  </header>

  <nav>
    <a href="index.html">ダッシュボード</a> |
    <a href="project-list.html">プロジェクト一覧</a> |
    <a href="task-list.html">タスク一覧</a> |
    <a href="task-create.html">タスク作成</a> |
    <a href="project-create.html">プロジェクト作成</a>
  </nav>

  <section>
    <form id="taskForm">
      <div>
        <label for="name">タスク名</label>
        <input type="text" id="name" required />
      </div>
      <div>
        <label for="type">種類</label>
        <select id="type">
          <option value="予定">予定</option>
          <option value="やること">やること</option>
        </select>
      </div>
      <div>
        <label for="projectId">プロジェクト</label>
        <select id="projectId">
          <option value="">（なし）</option>
        </select>
      </div>
      <div>
        <label for="deadline">締め切り日</label>
        <input type="date" id="deadline" required />
      </div>
      <div>
        <label for="scheduledDate">作業予定日</label>
        <input type="date" id="scheduledDate" required />
      </div>
      <div>
        <label for="priority">優先度</label>
        <select id="priority">
          <option value="絶対">絶対</option>
          <option value="できたら">できたら</option>
          <option value="やったらおもろそう">やったらおもろそう</option>
        </select>
      </div>
      <button type="submit">作成</button>
    </form>
  </section>

  <script src="common.js"></script>
  <script>
    (function(){
      const urlParams = new URLSearchParams(window.location.search);
      const paramProjectId = urlParams.get("projectId");

      const projectSelect = document.getElementById("projectId");
      const projects = getProjects();
      projects.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.id;
        opt.textContent = p.name;
        // URLパラメータと一致すれば選択状態に
        if (paramProjectId && paramProjectId === p.id) {
          opt.selected = true;
        }
        projectSelect.appendChild(opt);
      });

      document.getElementById("taskForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const name = document.getElementById("name").value.trim();
        const type = document.getElementById("type").value;
        const projectId = document.getElementById("projectId").value;
        const deadline = document.getElementById("deadline").value;
        const scheduledDate = document.getElementById("scheduledDate").value;
        const priority = document.getElementById("priority").value;

        if (!name || !deadline || !scheduledDate) {
          alert("必須項目が未入力です。");
          return;
        }

        const newTask = {
          name,
          type,
          projectId,
          deadline,
          scheduledDate,
          priority,
          // フェーズは未完了で初期化
          phase1Done: false,
          phase2Done: false,
          phase3Done: false
        };

        addTask(newTask);
        alert("タスクを作成しました");
        window.location.href = "task-list.html";
      });
    })();
  </script>
</body>
</html>
