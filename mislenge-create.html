<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Mislenge & Project ä½œæˆ</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <nav>
    <a href="index.html">ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
    <a href="project-list.html">ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</a>
    <a href="task-list.html">âœ… ã‚¿ã‚¹ã‚¯ä¸€è¦§</a>
    <a href="mislenge-create.html">â• Mislenge / Project ä½œæˆ</a>
  </nav>

  <div class="container">
    <h1>â• Mislenge / Project ä½œæˆ</h1>
    <div class="tab-container">
      <button class="tab-button active" onclick="switchTab('mislenge')">Mislenge ä½œæˆ</button>
      <button class="tab-button" onclick="switchTab('project')">Project ä½œæˆ</button>
    </div>
    
    <div id="mislenge-form" class="tab-content active">
      <h2>Mislenge ä½œæˆ</h2>
      <form id="mislengeForm">
        <input type="text" id="name" placeholder="Mislenge å" required>
        <select id="type">
          <option value="Task">Task</option>
          <option value="Schedule">Schedule</option>
        </select>
        <div id="taskFields">
          <input type="date" id="deadline" placeholder="ç· ã‚åˆ‡ã‚Šæ—¥">
          <input type="text" id="priority" placeholder="å„ªå…ˆåº¦">
          <input type="text" id="relatedUrl" placeholder="é–¢é€£URL">
        </div>
        <div id="scheduleFields" style="display: none;">
          <input type="datetime-local" id="scheduleDate" placeholder="äºˆå®šæ—¥æ™‚">
          <input type="text" id="location" placeholder="å ´æ‰€">
        </div>
        <select id="projectId">
          <option value="">ï¼ˆãªã—ï¼‰</option>
        </select>
        <button type="submit">ä½œæˆ</button>
      </form>
    </div>
    
    <div id="project-form" class="tab-content">
      <h2>Project ä½œæˆ</h2>
      <form id="projectForm">
        <input type="text" id="projectName" placeholder="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå" required>
        <input type="date" id="projectStart" placeholder="é–‹å§‹æ—¥" required>
        <input type="date" id="projectEnd" placeholder="çµ‚äº†æ—¥" required>
        <button type="submit">ä½œæˆ</button>
      </form>
    </div>
  </div>

  <script type="module">
    import { getDataFromURL, addData } from "./common.js";

    function switchTab(tab) {
      document.querySelectorAll(".tab-content").forEach(el => el.classList.remove("active"));
      document.querySelectorAll(".tab-button").forEach(el => el.classList.remove("active"));
      document.getElementById(`${tab}-form`).classList.add("active");
      document.querySelector(`button[onclick="switchTab('${tab}')"]`).classList.add("active");
    }

    document.getElementById("type").addEventListener("change", function() {
      const isTask = this.value === "Task";
      document.getElementById("taskFields").style.display = isTask ? "block" : "none";
      document.getElementById("scheduleFields").style.display = isTask ? "none" : "block";
    });

    document.addEventListener("DOMContentLoaded", function() {
      const projectSelect = document.getElementById("projectId");
      const projects = getDataFromURL().filter(item => item.type === "Project");
      projects.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.id;
        opt.textContent = p.name;
        projectSelect.appendChild(opt);
      });
    });

    document.getElementById("mislengeForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const type = document.getElementById("type").value;
      const name = document.getElementById("name").value.trim();
      const projectId = document.getElementById("projectId").value;
      let newMislenge = {
        id: Date.now().toString(),
        name, type, projectId,
        deadline: document.getElementById("deadline").value,
        priority: document.getElementById("priority").value,
        relatedUrl: document.getElementById("relatedUrl").value,
        scheduleDate: document.getElementById("scheduleDate").value,
        location: document.getElementById("location").value
      };
      addData(newMislenge);
      alert("Mislengeã‚’ä½œæˆã—ã¾ã—ãŸ");
      window.location.href = "task-list.html";
    });
    
    document.getElementById("projectForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const project = {
        id: Date.now().toString(),
        type: "Project",
        name: document.getElementById("projectName").value.trim(),
        startDate: document.getElementById("projectStart").value,
        endDate: document.getElementById("projectEnd").value
      };
      addData(project);
      alert("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ");
      window.location.href = "project-list.html";
    });
  </script>
</body>
</html>