<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Mislenge & Project ä½œæˆ</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¿ã‚¤ãƒ« */
    .tab-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .tab-button {
      padding: 10px 20px;
      cursor: pointer;
      border: none;
      background: #9ac387;
      color: white;
      font-size: 16px;
      transition: 0.3s;
    }
    .tab-button.active {
      background: #00776e;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <nav>
    <a href="home.html">ğŸ  ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
    <a href="project-list.html">ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</a>
    <a href="task-list.html">âœ… ã‚¿ã‚¹ã‚¯ä¸€è¦§</a>
    <a href="mislenge-create.html">â• Mislenge / Project ä½œæˆ</a>
    <button onclick="logout()">ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </nav>

  <div class="container">
    <h1>â• Mislenge / Project ä½œæˆ</h1>

    <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
    <div class="tab-container">
      <button class="tab-button active" onclick="switchTab('mislenge')">Mislenge ä½œæˆ</button>
      <button class="tab-button" onclick="switchTab('project')">Project ä½œæˆ</button>
    </div>

    <!-- Mislenge ä½œæˆãƒ•ã‚©ãƒ¼ãƒ  -->
    <div id="mislenge-form" class="tab-content active">
      <h2>Mislenge ä½œæˆ</h2>
      <form id="mislengeForm">
        <div>
          <label for="name">Mislenge å</label>
          <input type="text" id="name" required />
        </div>
        <div>
          <label for="type">ç¨®åˆ¥</label>
          <select id="type">
            <option value="Task">Task</option>
            <option value="Schedule">Schedule</option>
          </select>
        </div>
        <div id="taskFields">
          <div>
            <label for="deadline">ç· ã‚åˆ‡ã‚Šæ—¥</label>
            <input type="date" id="deadline" />
          </div>
          <div>
            <label for="scheduledDate">äºˆå®šæ—¥</label>
            <input type="date" id="scheduledDate" />
          </div>
          <div>
            <label for="priority">å„ªå…ˆåº¦</label>
            <select id="priority">
              <option value="çµ¶å¯¾">çµ¶å¯¾</option>
              <option value="ã§ããŸã‚‰">ã§ããŸã‚‰</option>
              <option value="ã‚„ã£ãŸã‚‰ãŠã‚‚ã‚ãã†">ã‚„ã£ãŸã‚‰ãŠã‚‚ã‚ãã†</option>
            </select>
          </div>
          <div>
            <label for="relatedUrl">é–¢é€£URL</label>
            <input type="text" id="relatedUrl" />
          </div>
        </div>
        <div id="scheduleFields" style="display: none;">
          <div>
            <label for="scheduleDate">äºˆå®šæ—¥æ™‚</label>
            <input type="datetime-local" id="scheduleDate" />
          </div>
          <div>
            <label for="location">å ´æ‰€</label>
            <input type="text" id="location" />
          </div>
        </div>
        <div>
          <label for="projectId">é–¢é€£ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</label>
          <select id="projectId">
            <option value="">ï¼ˆãªã—ï¼‰</option>
          </select>
        </div>
        <button type="submit">ä½œæˆ</button>
      </form>
    </div>

    <!-- Project ä½œæˆãƒ•ã‚©ãƒ¼ãƒ  -->
    <div id="project-form" class="tab-content">
      <h2>Project ä½œæˆ</h2>
      <form id="projectForm">
        <div>
          <label for="projectName">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</label>
          <input type="text" id="projectName" required />
        </div>
        <div>
          <label for="projectStart">é–‹å§‹æ—¥</label>
          <input type="date" id="projectStart" required />
        </div>
        <div>
          <label for="projectEnd">çµ‚äº†æ—¥</label>
          <input type="date" id="projectEnd" required />
        </div>
        <button type="submit">ä½œæˆ</button>
      </form>
    </div>
  </div>

  <script src="common.js"></script>
  <script>
    function switchTab(tab) {
      document.querySelectorAll(".tab-content").forEach(el => el.classList.remove("active"));
      document.querySelectorAll(".tab-button").forEach(el => el.classList.remove("active"));

      document.getElementById(`${tab}-form`).classList.add("active");
      document.querySelector(`button[onclick="switchTab('${tab}')"]`).classList.add("active");
    }

    document.getElementById("type").addEventListener("change", function() {
      const isTask = this.value === "Task";
      document.getElementById("taskFields").style.display = isTask ? "block" : "none";
      document.getElementById("scheduleFields").style.display = isTask ? "none" : "block";
    });

    (function() {
      // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¦ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã«è¿½åŠ 
      const projectSelect = document.getElementById("projectId");
      loadProjectsFromFirestore();
      setTimeout(() => {
        getProjects().forEach(p => {
          const opt = document.createElement("option");
          opt.value = p.id;
          opt.textContent = p.name;
          projectSelect.appendChild(opt);
        });
      }, 1000);

      // Mislenge ä½œæˆå‡¦ç†
      document.getElementById("mislengeForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const type = document.getElementById("type").value;
        const name = document.getElementById("name").value.trim();
        const projectId = document.getElementById("projectId").value;
        let newMislenge = { name, type, projectId };

        if (type === "Task") {
          newMislenge = {
            ...newMislenge,
            deadline: document.getElementById("deadline").value,
            scheduledDate: document.getElementById("scheduledDate").value,
            priority: document.getElementById("priority").value,
            relatedUrl: document.getElementById("relatedUrl").value,
            phase1: false,
            phase2: false,
            phase3: false
          };
        } else {
          newMislenge = {
            ...newMislenge,
            scheduleDate: document.getElementById("scheduleDate").value,
            location: document.getElementById("location").value
          };
        }

        addMislenge(newMislenge);
        alert("Mislengeã‚’ä½œæˆã—ã¾ã—ãŸ");
        window.location.href = "task-list.html";
      });

      // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆå‡¦ç†
      document.getElementById("projectForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const project = {
          name: document.getElementById("projectName").value.trim(),
          startDate: document.getElementById("projectStart").value,
          endDate: document.getElementById("projectEnd").value
        };

        addProject(project);
        alert("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ");
        window.location.href = "project-list.html";
      });
    })();
  </script>
</body>
</html>
